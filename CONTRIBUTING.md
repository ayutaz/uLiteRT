# コントリビューションガイド

uLiteRT へのコントリビューションに興味を持っていただきありがとうございます。
このドキュメントでは、開発環境のセットアップからプルリクエストの提出までの手順を説明します。

## 開発環境セットアップ

以下のツールが必要です。

| ツール | バージョン |
|---|---|
| Unity | 6000.3.2f1 (Unity 6 LTS) |
| .NET | 4.7.1 |
| テストフレームワーク | Unity Test Framework 1.6.0 |
| IDE | Rider または Visual Studio (推奨) |

1. リポジトリをクローンします。
2. Unity Hub からプロジェクトを開きます (Unity 6000.3.2f1 を使用)。
3. 必要に応じてネイティブライブラリをビルドします (後述)。

## ネイティブライブラリビルド

ネイティブライブラリ (.dll / .so) は Git リポジトリに含まれていないため、各環境でビルドが必要です。

ビルドスクリプトは `BuildScripts/` ディレクトリに配置されています。
詳細な手順は [CLAUDE.md](CLAUDE.md) の「ネイティブライブラリビルド」セクションを参照してください。

### Android (arm64)

```bash
# Docker が起動している状態で実行
bash BuildScripts/build_all.sh
```

### Windows (x86_64)

```bash
# Bazel がインストール済みであること
BuildScripts\build_native.bat
```

## コーディング規約

- **コメント・ドキュメント**: 日本語で記述してください。
- **P/Invoke パターン**: 新しい P/Invoke 宣言を追加する場合は `Assets/LiteRT/Runtime/Native.cs` の既存パターンに従ってください。
- **IDisposable パターン**: ネイティブリソースを保持するクラスは `IDisposable` パターンを適用し、Finalizer も実装してください。
- **マーシャリング**: `size_t` は `UIntPtr`、C の `bool` は `[MarshalAs(UnmanagedType.I1)]` を使用してください。
- **命名規則**: C# 標準の命名規則 (PascalCase / camelCase) に従ってください。

## プルリクエスト手順

1. リポジトリを **Fork** します。
2. フィーチャーブランチを作成します (`git checkout -b feature/your-feature`)。
3. 変更をコミットします。コミットメッセージは日本語で記述してください。
4. すべてのテストがパスすることを確認します (後述)。
5. Fork 先にプッシュし、本リポジトリへ **Pull Request** を作成します。

### プルリクエストの内容

- 変更の目的と概要を明記してください。
- 関連する Issue がある場合はリンクしてください。
- 新機能の場合はテストを追加してください。

## テスト実行方法

1. Unity エディタで **Window > General > Test Runner** を開きます。
2. **PlayMode** タブを選択します。
3. **Run All** をクリックしてすべてのテストを実行します。
4. すべてのテスト (122テスト) がパスすることを確認してください。

テストファイルは以下に配置されています:
- `Assets/LiteRT/Tests/Runtime/` — コアライブラリテスト (89テスト)
- `Assets/LiteRT/Tests/Samples/` — サンプル共通基盤テスト (33テスト)

## Issue 報告ガイドライン

バグ報告や機能リクエストは GitHub Issues で受け付けています。
バグ報告の際は以下の情報を記載してください。

- **Unity バージョン** (例: 6000.3.2f1)
- **プラットフォーム** (例: Android arm64, Windows x86_64)
- **LiteRT バージョン** (例: v2.1.2)
- **再現手順**: 問題を再現するための具体的な手順
- **期待される動作**: 本来どう動作すべきか
- **実際の動作**: 実際に起きた現象 (エラーメッセージ・ログがあれば添付)

## ライセンス

コントリビューションは [Apache License 2.0](LICENSE) の下でライセンスされます。
プルリクエストを提出することで、このライセンスに同意したものとみなされます。
